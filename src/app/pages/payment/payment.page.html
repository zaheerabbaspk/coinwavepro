<ion-content [fullscreen]="true" class="ion-padding">
  <div class="max-w-lg mx-auto my-20 space-y-6">

    <!-- Step Indicator -->
    <app-step-indicator [currentStep]="currentStep" [totalSteps]="3"></app-step-indicator>

    <!-- ========================== STEP 1: Payment Address ========================== -->
    <ng-container *ngIf="currentStep === 1">
      <!-- Order Summary Card -->
      <div class="bg-gray-800 border border-gray-700 rounded-2xl p-5">
        <h3 class="text-white font-bold text-lg mb-4">Order Summary</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Package</span>
            <span class="text-white font-medium">{{ selectedPackage.name }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Duration</span>
            <span class="text-white font-medium">{{ selectedPackage.duration }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Expected Return</span>
            <span class="text-emerald-400 font-medium">${{ selectedPackage.returns }}.00</span>
          </div>
          <div class="border-t border-gray-700 pt-3 flex justify-between items-center">
            <span class="text-white font-semibold">Total</span>
            <span class="text-emerald-400 font-bold text-xl">${{ selectedPackage.price }}.00</span>
          </div>
        </div>
      </div>

      <!-- Payment Address Card -->
      <div class="bg-gray-800 border border-gray-700 rounded-2xl p-5">
        <h3 class="text-white font-bold text-lg mb-2">Payment Address</h3>
        <p class="text-gray-400 text-sm mb-4">
          Send exactly <span class="text-emerald-400 font-semibold">${{ selectedPackage.price }}.00 USDT</span> to the
          address below:
        </p>

        <!-- Wallet Address -->
        <div class="bg-gray-900 rounded-xl px-4 py-3 flex items-center justify-between gap-3">
          <div class="flex-1 overflow-hidden">
            <span class="text-gray-500 text-xs">TRC20:</span>
            <p class="text-white font-mono text-sm truncate">{{ walletAddress }}</p>
          </div>
          <button (click)="copyAddress()" class="flex-shrink-0 p-2 rounded-lg hover:bg-gray-700 transition-colors"
            [class.text-emerald-400]="copied" [class.text-gray-400]="!copied">
            <svg *ngIf="!copied" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <svg *ngIf="copied" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </button>
        </div>

        <!-- Open Binance Link -->
        <button (click)="openBinance()"
          class="mt-4 text-cyan-400 text-sm flex items-center justify-center gap-1 w-full hover:text-cyan-300 transition-colors">
          Open Binance
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"
            stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
        </button>
      </div>

      <!-- Important Notice -->
      <div class="bg-amber-500/10 border border-amber-500/30 rounded-2xl p-4 flex gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-400 flex-shrink-0 mt-0.5" fill="none"
          viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div>
          <h4 class="text-amber-400 font-semibold text-sm">Important</h4>
          <p class="text-gray-300 text-sm mt-1">
            Payments are processed within 24 hours. Make sure to send the exact amount to avoid delays.
          </p>
        </div>
      </div>

      <!-- Confirm Button -->
      <button (click)="confirmPayment()"
        class="w-full bg-emerald-500 text-white py-4 rounded-2xl font-semibold text-lg hover:bg-emerald-600 transition-colors">
        I've Made the Payment
      </button>
    </ng-container>

    <!-- ========================== STEP 2: Upload Proof ========================== -->
    <ng-container *ngIf="currentStep === 2">
      <!-- Upload Card -->
      <div class="bg-gray-800 border border-gray-700 rounded-2xl p-5">
        <h3 class="text-white font-bold text-lg mb-2">Upload Payment Proof</h3>
        <p class="text-gray-400 text-sm mb-4">
          Take a screenshot of your transaction and upload it below for verification.
        </p>

        <!-- Upload Area -->
        <div class="border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors"
          [class.border-gray-600]="!isDragging && !selectedFile" [class.border-emerald-500]="isDragging"
          [class.border-emerald-500]="selectedFile" [class.bg-emerald-500/10]="selectedFile"
          (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
          (click)="fileInput.click()">

          <input type="file" #fileInput class="hidden" accept="image/png,image/jpeg,image/jpg"
            (change)="onFileSelect($event)" />

          <ng-container *ngIf="!selectedFile">
            <!-- Upload Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-gray-500 mb-3" fill="none"
              viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            <p class="text-white font-medium">Click to upload</p>
            <p class="text-gray-500 text-sm mt-1">PNG, JPG up to 5MB</p>
          </ng-container>

          <ng-container *ngIf="selectedFile">
            <!-- File Selected -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-emerald-400 mb-3" fill="none"
              viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-emerald-400 font-medium">{{ selectedFileName }}</p>
            <button (click)="removeFile(); $event.stopPropagation()"
              class="text-gray-400 hover:text-red-400 text-sm mt-2">
              Remove file
            </button>
          </ng-container>
        </div>
      </div>

      <!-- Transaction ID Input -->
      <app-form-input label="Transaction ID (Optional)" placeholder="Enter transaction hash/ID" icon="hash"
        [(ngModel)]="transactionId">
      </app-form-input>

      <!-- Action Buttons -->
      <div class="grid grid-cols-2 gap-4">
        <button (click)="goBackToStep1()"
          class="py-4 rounded-2xl font-semibold text-lg bg-gray-700 text-white hover:bg-gray-600 transition-colors">
          Back
        </button>
        <button (click)="submitProof()"
          class="py-4 rounded-2xl font-semibold text-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors">
          Submit
        </button>
      </div>
    </ng-container>

    <!-- ========================== STEP 3: Confirmation ========================== -->
    <ng-container *ngIf="currentStep === 3">
      <!-- Success Icon -->
      <div class="flex justify-center py-8">
        <div class="w-24 h-24 rounded-full bg-emerald-500/20 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-emerald-400" fill="none" viewBox="0 0 24 24"
            stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
      </div>

      <!-- Success Message -->
      <div class="text-center">
        <h2 class="text-2xl font-bold text-white mb-2">Payment Submitted!</h2>
        <p class="text-gray-400">
          Your payment is being reviewed. You'll receive a notification once it's approved.
        </p>
      </div>

      <!-- Status Card -->
      <div class="bg-gray-800 border border-gray-700 rounded-2xl p-5 space-y-3">
        <div class="flex justify-between items-center">
          <span class="text-gray-400">Status</span>
          <span class="text-amber-400 font-medium">Pending Approval</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-400">Expected Time</span>
          <span class="text-white font-medium">Within 24 hours</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-400">Order ID</span>
          <span class="text-white font-medium">{{ orderId }}</span>
        </div>
      </div>

      <!-- Back to Dashboard Button -->
      <button (click)="goToDashboard()"
        class="w-full bg-emerald-500 text-white py-4 rounded-2xl font-semibold text-lg hover:bg-emerald-600 transition-colors">
        Back to Dashboard
      </button>
    </ng-container>

  </div>
</ion-content>